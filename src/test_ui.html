<link rel="stylesheet" type="text/css" href="/animate.css"></link>
<script type="module">
import {Game} from './game.js';
import {Character, Player} from './characters.js';
import {Left, Right, Center} from './positions.js'
import * as ui from './ui.js';
import {Scene} from './ui.js';

import Typed from './typed/typed.js';
var Sonic = Character.from_obj({
  name: 'Sonic',
  color: 'blue',
  assets: {
    images: {
      'default': 'sonic.png',
    },
  },
});
var s = Sonic.renderer;

var Me = new Player('Me', 'green');
var me = Me.renderer;

var game = new Game(Me);

var intro = new Scene({
  name: 'intro',
  cleanup: true,
  contents: async function(context) {
    return [
      ui.setBackground('pic.png'),
      await ui.Draw.draw(
          Sonic.get_image('default'), Left, {"height": "100%"}, 'lightSpeedIn'),
      s("Hi! I'm Sonic!"),
      s("How are you?"),
      ui.choice(
        ["I'm good! hbu?", 'doing_good'],
        ["bad.", ui.NO_ACTION],
      ),
      me("Bad."),
      s("Oh. I'm sorry to hear that."),
      ui.jump('credits')
    ];
  },
});

var doing_good = new Scene({
  name: 'doing_good',
  contents: function (context) {
    return [
      me("I'm doing well! How about you?"),
      s("I'm swell!"),
      ui.Draw.animate(Sonic.get_image('default'), 'bounce', {asynchronous: true, iterationCount: 'infinite', noCancel: true}),
      s("Thanks for asking!"),
      ui.jump('credits'),
    ];
  },
});

var credits = new Scene({
  name: 'credits',
  cleanup: true,
  contents: async function (context) {
    return [
      // TODO create scrolling credits.
      await ui.Draw.draw(Sonic.get_image('default'), Center, {"height": "100%"}, 'flipInY', {'duration': '500ms'}),
      s("This is the end of the game!"),
      s("Thanks for playing!"),
    ];
  },
});

(async function() {
  await Sonic.loaded;
  ui.initialize(document.body, [
    intro,
    doing_good,
    credits,
  ]);
  intro.run(game);
})();


window.game = game;
window.Sonic = Sonic;
window.s = s;
window.ui = ui;
window.Typed = Typed;
</script>
<body>
</body>
